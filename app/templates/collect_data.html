<!-- Collect_data.html -->
{% extends "base.html" %}
{% block content %}

<div class="container">
    <h2 class = "center-text" >Data Input</h2>
    <form method="POST" action="{{url_for('data_input.data_input_logic')}}" class="form-container">

    <div class = "form-group">
        <!-- Unit Dropdown -->
        <label for="unit">Select Unit:</label>
        <select id="unit" name="unit_name">
            <option value="">--Select Unit--</option>
            {% for unit in units %}
                <option value="{{ unit }}">{{ unit }}</option>
            {% endfor %}
        </select>

        <!-- Resident Dropdown -->
        <label for="resident">Select Resident:</label>
        <select id="resident" name="resident_initials">
        </select>

        <!-- Service Dropdown -->
        <label for = "service" > Select Service: </label>
        <select id = "service" name = "service_name">
            <option value = "" > -- Select Service -- </option>
            {% for service in services %}
                <option value="{{ service }}">{{ service }}</option>
            {% endfor %}
        </select>



    </div>

        <button type="submit">Submit</button>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Get references to dropdowns
            const unitDropdown = document.getElementById('unit');
            const residentDropdown = document.getElementById('resident');

            // Event listener for unit selection
            unitDropdown.addEventListener('change', function () {
                const selectedUnit = unitDropdown.value;

                // Clear the resident dropdown
                residentDropdown.innerHTML = '<option value="">--Select Resident--</option>';

                if (selectedUnit) {
                    // Fetch residents for the selected unit
                    fetch('/get_residents', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ unit: selectedUnit })
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Populate the resident dropdown with the fetched data
                        data.residents.forEach(function (resident) {
                            const option = document.createElement('option');
                            option.value = resident;
                            option.textContent = resident;
                            residentDropdown.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching residents:', error);
                    });
                }
            });
        });
    </script>
{% endblock %}
